<?lu
    if headers.cookie then
        local found = aio:decrypt(headers.cookie:match("pid=([^ ;]+)"), aio:create_key("/session"))
        if found then
            local user = await(crymp:getUser{ id= tonumber(found) })
            if user then
                session.logged = user
                crymp:touch(user)
            end
        end
    end
?>